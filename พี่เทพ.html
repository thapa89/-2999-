import tkinter as tk
import numpy as np
from math import exp, factorial

# -----------------------------
# ฟังก์ชันคำนวณ
# -----------------------------

def แปลงราคาต่อรองเป็นความน่าจะเป็น(ราคาเจ้าบ้าน, ราคาเสมอ, ราคาทีมเยือน):
    """แปลงราคาบอลเป็นความน่าจะเป็นและปรับ Margin"""
    ความน่าจะเป็น_เจ้าบ้าน = 1 / ราคาเจ้าบ้าน
    ความน่าจะเป็น_เสมอ = 1 / ราคาเสมอ
    ความน่าจะเป็น_ทีมเยือน = 1 / ราคาทีมเยือน
    รวมทั้งหมด = ความน่าจะเป็น_เจ้าบ้าน + ความน่าจะเป็น_เสมอ + ความน่าจะเป็น_ทีมเยือน
    ความน่าจะเป็น_เจ้าบ้าน /= รวมทั้งหมด
    ความน่าจะเป็น_เสมอ /= รวมทั้งหมด
    ความน่าจะเป็น_ทีมเยือน /= รวมทั้งหมด
    return ความน่าจะเป็น_เจ้าบ้าน, ความน่าจะเป็น_เสมอ, ความน่าจะเป็น_ทีมเยือน

def ความน่าจะเป็น_poisson(xG, สูงสุดประตู=5):
    """คำนวณความน่าจะเป็นจำนวนประตูด้วย Poisson"""
    return [exp(-xG) * xG**i / factorial(i) for i in range(สูงสุดประตู+1)]

def ทำนายผลจาก_xG(xG_เจ้าบ้าน, xG_ทีมเยือน, สูงสุดประตู=5):
    """คำนวณความน่าจะเป็นชนะ/เสมอ/แพ้ และสกอร์แนะนำ"""
    prob_เจ้าบ้าน = ความน่าจะเป็น_poisson(xG_เจ้าบ้าน, สูงสุดประตู)
    prob_ทีมเยือน = ความน่าจะเป็น_poisson(xG_ทีมเยือน, สูงสุดประตู)
    ชนะ_เจ้าบ้าน = ชนะ_ทีมเยือน = เสมอ = 0
    for i, p_เจ้าบ้าน in enumerate(prob_เจ้าบ้าน):
        for j, p_ทีมเยือน in enumerate(prob_ทีมเยือน):
            p = p_เจ้าบ้าน * p_ทีมเยือน
            if i > j:
                ชนะ_เจ้าบ้าน += p
            elif i == j:
                เสมอ += p
            else:
                ชนะ_ทีมเยือน += p
    return ชนะ_เจ้าบ้าน, เสมอ, ชนะ_ทีมเยือน

# -----------------------------
# สร้าง GUI ภาษาไทย
# -----------------------------
หน้าต่าง = tk.Tk()
หน้าต่าง.title("วิเคราะห์ราคาบอลบ่อนแบบภาษาไทย")

# ราคาต่อรอง
tk.Label(หน้าต่าง, text="ราคาต่อรองเจ้าบ้าน 1X2").grid(row=0, column=0)
ช่องกรอก_เจ้าบ้าน = tk.Entry(หน้าต่าง)
ช่องกรอก_เจ้าบ้าน.grid(row=0, column=1)

tk.Label(หน้าต่าง, text="ราคาต่อรองเสมอ 1X2").grid(row=1, column=0)
ช่องกรอก_เสมอ = tk.Entry(หน้าต่าง)
ช่องกรอก_เสมอ.grid(row=1, column=1)

tk.Label(หน้าต่าง, text="ราคาต่อรองทีมเยือน 1X2").grid(row=2, column=0)
ช่องกรอก_ทีมเยือน = tk.Entry(หน้าต่าง)
ช่องกรอก_ทีมเยือน.grid(row=2, column=1)

# ค่า xG
tk.Label(หน้าต่าง, text="xG เจ้าบ้าน").grid(row=3, column=0)
ช่องกรอก_xG_เจ้าบ้าน = tk.Entry(หน้าต่าง)
ช่องกรอก_xG_เจ้าบ้าน.grid(row=3, column=1)

tk.Label(หน้าต่าง, text="xG ทีมเยือน").grid(row=4, column=0)
ช่องกรอก_xG_ทีมเยือน = tk.Entry(หน้าต่าง)
ช่องกรอก_xG_ทีมเยือน.grid(row=4, column=1)

# แสดงผล
ผลลัพธ์ = tk.Label(หน้าต่าง, text="", fg="blue")
ผลลัพธ์.grid(row=6, column=0, columnspan=2)

# -----------------------------
# ฟังก์ชันวิเคราะห์และแสดงผล
# -----------------------------
def วิเคราะห์ราคาบอล():
    try:
        ราคา_เจ้าบ้าน = float(ช่องกรอก_เจ้าบ้าน.get())
        ราคา_เสมอ = float(ช่องกรอก_เสมอ.get())
        ราคา_ทีมเยือน = float(ช่องกรอก_ทีมเยือน.get())
        xG_เจ้าบ้าน = float(ช่องกรอก_xG_เจ้าบ้าน.get())
        xG_ทีมเยือน = float(ช่องกรอก_xG_ทีมเยือน.get())
    except:
        ผลลัพธ์.config(text="กรุณากรอกตัวเลขให้ถูกต้อง")
        return
    
    # แปลงราคาต่อรองเป็นความน่าจะเป็น
    prob_เจ้าบ้าน, prob_เสมอ, prob_ทีมเยือน = แปลงราคาต่อรองเป็นความน่าจะเป็น(
        ราคา_เจ้าบ้าน, ราคา_เสมอ, ราคา_ทีมเยือน
    )
    
    # ทำนายผลจาก xG
    ชนะ_เจ้าบ้าน, เสมอ_xG, ชนะ_ทีมเยือน = ทำนายผลจาก_xG(xG_เจ้าบ้าน, xG_ทีมเยือน)
    
    text = (
        f"ความน่าจะเป็นจากบ่อน (ปรับ Margin):\n"
        f"เจ้าบ้านชนะ: {prob_เจ้าบ้าน:.2%}\n"
        f"เสมอ: {prob_เสมอ:.2%}\n"
        f"ทีมเยือนชนะ: {prob_ทีมเยือน:.2%}\n\n"
        f"ความน่าจะเป็นจาก xG:\n"
        f"เจ้าบ้านชนะ: {ชนะ_เจ้าบ้าน:.2%}\n"
        f"เสมอ: {เสมอ_xG:.2%}\n"
        f"ทีมเยือนชนะ: {ชนะ_ทีมเยือน:.2%}"
    )
    ผลลัพธ์.config(text=text)

# ปุ่มคำนวณ
tk.Button(หน้าต่าง, text="วิเคราะห์ราคาบอล", command=วิเคราะห์ราคาบอล).grid(row=5, column=0, columnspan=2)

หน้าต่าง.mainloop()
